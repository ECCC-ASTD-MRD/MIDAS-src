Version=1.0
Name=r.env.dot

if [[ "$1" = -h || "$1" = --help ]] ; then
  echo "usage: . $Name [-h|--help] [--version] [--verbose] --arch ARCH"
  echo "       Substitutes an ordenv environment for another."
  echo "       e.g. . \"$Name --arch Linux_x86-64\" will force that environment in the current session"
  echo "       Variables affected: BASE_ARCH, EC_ARCH, ORDENV_PLAT, SSMUSE_PLATFORMS"
  echo "NOTES: Arguments are order dependant"
  echo "       $Name should be called as soon as possible after the login sequence."
  echo "         All modifications to PATHs before the call to $Name remain in the environment"
  return
fi

if [[ "$1" = '-verbose' || "$1" = '--verbose' ]]
then
  echo Verbose mode activated
  echo $Name version $Version
  set -x
  shift
fi

if [[ "$1" = --version ]]
then
  echo $Name version $Version 
  return 0
fi

if [[ "$1" = --arch ]]
then
  arch=$2
  case $arch in
    broadwell)
      arch=sles-11-broadwell-64-xc40
      ;;
    haswell)
      arch=sles-11-haswell-64-xc40
      ;;
  esac
  
  export BASE_ARCH=$arch
  if [[ -n $COMP_ARCH ]]
  then
    export EC_ARCH=$BASE_ARCH/$COMP_ARCH
  else
    export EC_ARCH=$BASE_ARCH
  fi
  export ORDENV_PLAT=$arch
  export SSMUSE_PLATFORMS="$arch $SSMUSE_PLATFORMS"
fi



