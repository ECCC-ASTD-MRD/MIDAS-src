!-------------------------------------- LICENCE BEGIN ------------------------------------
!Environment Canada - Atmospheric Science and Technology License/Disclaimer,
!                     version 3; Last Modified: May 7, 2008.
!This is free but copyrighted software; you can use/redistribute/modify it under the terms
!of the Environment Canada - Atmospheric Science and Technology License/Disclaimer
!version 3 or (at your option) any later version that should be found at:
!http://collaboration.cmc.ec.gc.ca/science/rpn.comm/license.html
!
!This software is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
!without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
!See the above mentioned License/Disclaimer for more details.
!You should have received a copy of the License/Disclaimer along with this software;
!if not, you can write to: EC-RPN COMM Group, 2121 TransCanada, suite 500, Dorval (Quebec),
!CANADA, H9P 1J3; or send e-mail to service.rpn@ec.gc.ca
!-------------------------------------- LICENCE END --------------------------------------
!
SUBROUTINE IASIEXTRACT(inele,inval,i3d,NCLASSAVHRR,NCHANAVHRR,j3d,ilist,itbl,cfrac,radmoy,radstd)
implicit none
#include "compileswitches.inc"
!sizes
INTEGER ,INTENT(IN) :: inele,inval,i3d
INTEGER ,INTENT(IN) :: NCLASSAVHRR,NCHANAVHRR
!position
INTEGER ,INTENT(IN) :: j3d
 !input arrays extracted from BURP files
INTEGER ,INTENT(IN) :: ilist(inele),itbl(iNELE,inval,i3d) 
!output arrays to insert later into obsspacedata
INTEGER ,intent(out) :: cfrac(NCLASSAVHRR)
Real (OBS_REAL) ,intent(out) :: radmoy(NCLASSAVHRR,NCHANAVHRR),radstd(NCLASSAVHRR,NCHANAVHRR)
!**************************************************************************************
INTEGER :: IBKNO,taille
REAL (8) :: ZVAL(iNELE,inval,i3d)
INTEGER :: IER,iclass,ichan,inorm,ival,iele
integer ,external :: VMRBCVT
!*****************************

ZVAL=dble(ITBL)

IER=VMRBCVT(iLIST,ITBL,ZVAL,INELE,INVAL,I3D,0)
IF (IER/=0) call abort3d('iasiextract        ')

iclass=1
do ival=1,inval
   DO  iele=1,iNELE
      SELECT CASE(ILIST(iele))
      CASE(25085)
         CFRAC(iclass)=zval(iele,ival,j3d)
      CASE(5042)
         ICHAN=zval(iele,ival,j3d)
      CASE(25142)
         INORM=zval(iele,ival,j3d)
      CASE(14047)
         RADMOY(iclass,ICHAN)=ZVAL(iele,ival,j3d) * 10.d0**(-1.d0 * INORM ) * 100000.d0
      CASE(14048)
         RADSTD(iclass,ICHAN)=ZVAL(iele,ival,j3d) * 10.d0**(-1.d0 * INORM ) * 100000.d0
         IF (ICHAN==NCHANAVHRR) iclass=iclass+1
         IF ( iclass==(NCLASSAVHRR+1) ) RETURN
      END SELECT
   enddo
ENDDO
      
END SUBROUTINE IASIEXTRACT
