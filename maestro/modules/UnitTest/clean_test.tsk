#!/bin/ksh

cd ${TMPDIR}

unittest=$(dirname ${SEQ_CONTAINER})
testworkdir=${SEQ_WORKBASE}/${unittest}

testhubdir=${ENVAR_output}

VAR_host=$(${SEQ_BIN}/nodeinfo -n ${SEQ_CONTAINER}/envar/VAR -f res | grep node\.machine | cut -d'=' -f2)
testworkdir_remote=${SEQ_EXP_HOME}/hub/${VAR_host}/work/${SEQ_DATE}/${SEQ_CONTAINER}/envar

if [ "${UnitTest_cleanup}" = yes ]; then
    ${SEQ_BIN}/nodelogger -n ${SEQ_NODE} -s infox  -m "Erasing test ${unittest}: ${testworkdir}"
    rm -rf ${testworkdir}
    ${SEQ_BIN}/nodelogger -n ${SEQ_NODE} -s infox  -m "Erasing test ${unittest}: ${testhubdir}"
    rm -rf ${testhubdir}

    if [ "${VAR_host}" != "${TRUE_HOST}" ]; then
	testworkdir_remote=${SEQ_EXP_HOME}/hub/${VAR_host}/work/${SEQ_DATE}/${SEQ_CONTAINER}/envar
	${SEQ_BIN}/nodelogger -n ${SEQ_NODE} -s infox  -m "Erasing test ${unittest}: ${VAR_host}:${testworkdir_remote}"
	ssh ${VAR_host} rm -rf ${testworkdir_remote}
    fi
else
    ${SEQ_BIN}/nodelogger -n ${SEQ_NODE} -s infox  -m "We do not erase the working directory for unit test ${unittest}: ${testworkdir}"
    ${SEQ_BIN}/nodelogger -n ${SEQ_NODE} -s infox  -m "We do not erase the hub directory for unit test ${unittest}: ${testhubdir}"
    if [ "${VAR_host}" != "${TRUE_HOST}" ]; then
	testworkdir_remote=${SEQ_EXP_HOME}/hub/${VAR_host}/work/${SEQ_DATE}/${SEQ_CONTAINER}/envar
	${SEQ_BIN}/nodelogger -n ${SEQ_NODE} -s infox  -m "We do not erase the remote working directory for unit test ${unittest}: ${VAR_host}:${testworkdir_remote}"
    fi
fi
